#!/data/data/com.termux/files/usr/bin/bash
# Claw Notes - Full Pipeline
#
# Record → Transcribe → Process (all in one)
#
# Usage: claw-full [name]

set -e

SCRIPT_DIR="$(cd "$(dirname "$0")" && pwd)"
source "$SCRIPT_DIR/../lib/config.sh"

ensure_dirs

NAME="${1:-note}"

echo "==========================================="
echo "  Claw Notes - Full Pipeline"
echo "==========================================="
echo ""

# Step 1: Record
log_info "Step 1/3: Recording..."
echo ""
AUDIO_FILE=$("$CLAW_BIN/claw-record" "$NAME")
echo ""

if [ ! -f "$AUDIO_FILE" ]; then
    log_error "Recording failed"
    exit 1
fi

# Step 2: Transcribe
log_info "Step 2/3: Transcribing..."
echo ""
TRANSCRIPT_FILE=$("$CLAW_BIN/claw-transcribe" "$AUDIO_FILE")
echo ""

if [ ! -f "$TRANSCRIPT_FILE" ]; then
    log_error "Transcription failed"
    exit 1
fi

# Step 3: Process
log_info "Step 3/3: Processing with LLM..."
echo ""
"$CLAW_BIN/claw-process" "$TRANSCRIPT_FILE"

echo ""
echo "==========================================="
log_ok "Pipeline complete!"
echo "==========================================="
echo ""
echo "Output files in:"
echo "  - assets/           (audio)"
echo "  - transcripts/raw/  (whisper output)"
echo "  - transcripts/cleaned/ (LLM cleaned)"
echo "  - summaries/        (AI summary)"
echo ""
echo "Run 'claw sync' to commit changes"
